<!DOCTYPE html>
<html lang="pt-br" th:replace="~{layout/dashboard/principal :: layout (~{:: content}, 'Nova solicitação')}">

<body>
    <content>
        <div class="container-lg">
            <!-- Page header -->
            <div class="row align-items-center mb-7">
                <div class="col-auto">
                    <!-- Avatar -->
                    <div class="avatar avatar-xl rounded text-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-bookmark-plus" viewBox="0 0 16 16">
                            <path
                                d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.777.416L8 13.101l-5.223 2.815A.5.5 0 0 1 2 15.5zm2-1a1 1 0 0 0-1 1v12.566l4.723-2.482a.5.5 0 0 1 .554 0L13 14.566V2a1 1 0 0 0-1-1z" />
                            <path
                                d="M8 4a.5.5 0 0 1 .5.5V6H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V7H6a.5.5 0 0 1 0-1h1.5V4.5A.5.5 0 0 1 8 4" />
                        </svg>
                    </div>
                </div>
                <div class="col">
                    <!-- Breadcrumb -->
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb mb-2">
                            <li class="breadcrumb-item"><a class="text-body-secondary" href="/inicio">Página Inicial</a>
                            </li>
                            <li class="breadcrumb-item"><a class="text-body-secondary" href="/solicitacoes">Solicitações</a>
                            </li>
                        </ol>
                    </nav>

                    <!-- Heading -->
                    <h1 class="fs-4 mb-0">Nova solicitação</h1>
                </div>
            </div>

            <div class="container py-5">

                <form class="row g-3" th:object="${newRequest}" method="POST" action="/requests/new"
                    enctype="multipart/form-data">
                    <div class="form-floating col-12">
                        <textarea class="form-control" id="description" name="description" placeholder="Descrição"
                            ></textarea>
                    </div>

                    <div class="form-floating col-12">
                        <select class="form-select" id="requestType" name="requestType" required>
                            <option value="" selected disabled>Selecione um tipo de solicitação</option>
                            <option th:each="requestType : ${requestTypeList}" th:value="${requestType.id}"
                                th:text="${requestType.title  + ' - ' + requestType.department.name}">
                            </option>
                        </select>
                        <label for="requestType">Tipo de Solicitação</label>
                    </div>

                    <div class="form-floating">
                        <select id="category" class="form-select" required name="category">
                            <option value="" selected disabled>Selecione a categoria</option>
                            <!-- Adicione aqui as opções de Category -->
                            <option th:each="category : ${categories}" th:value="${category}"
                                th:text="${category.description}"></option>
                        </select>
                        <label for="category">Categoria</label>
                        <div class="invalid-feedback">
                            Por favor, selecione a categoria.
                        </div>
                    </div>

                    <div class="col-12">
                        <label for="attachments" class="form-label">Anexos</label>
                        <input class="form-control" type="file" id="attachments" name="files" multiple>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-6">
                        <button type="submit" class="btn btn-primary">Enviar</button>
                    </div>
                </form>
            </div>

        </div>

        <script>
            window.onload = () => {
                const {
                    ClassicEditor,
                    Autosave,
                    BalloonToolbar,
                    BlockQuote,
                    Bold,
                    Essentials,
                    Heading,
                    Indent,
                    IndentBlock,
                    Italic,
                    Link,
                    Paragraph,
                    Table,
                    TableCaption,
                    TableCellProperties,
                    TableColumnResize,
                    TableProperties,
                    TableToolbar,
                    Underline
                } = window.CKEDITOR;


                const LICENSE_KEY =
                    'eyJhbGciOiJFUzI1NiJ9.eyJleHAiOjE3NDA3MDA3OTksImp0aSI6IjBmYWVlMWJkLTIzNGYtNDQ3MC1hOGViLTRmZGE5Y2MwYTg2YSIsImxpY2Vuc2VkSG9zdHMiOlsiKi53ZWJjb250YWluZXIuaW8iLCIqLmpzaGVsbC5uZXQiLCIqLmNzcC5hcHAiLCJjZHBuLmlvIiwiMTI3LjAuMC4xIiwibG9jYWxob3N0IiwiMTkyLjE2OC4qLioiLCIxMC4qLiouKiIsIjE3Mi4qLiouKiIsIioudGVzdCIsIioubG9jYWxob3N0IiwiKi5sb2NhbCJdLCJkaXN0cmlidXRpb25DaGFubmVsIjpbImNsb3VkIiwiZHJ1cGFsIiwic2giXSwibGljZW5zZVR5cGUiOiJldmFsdWF0aW9uIiwidmMiOiJjOWIzZTcyNCJ9.5PtiNYRYe5iP1UrqMnr-Cv-U2DahGU0ToZrDx4Re13YLC_12NSjrnC2JLkhuKhuRqO3Im1cLQYi0jJV3BkKz5w';

                const editorConfig = {
                    toolbar: {
                        items: ['heading', '|', 'bold', 'italic', 'underline', '|', 'link', 'insertTable', 'blockQuote', '|', 'outdent', 'indent'],
                        shouldNotGroupWhenFull: false
                    },
                    plugins: [
                        Autosave,
                        BalloonToolbar,
                        BlockQuote,
                        Bold,
                        Essentials,
                        Heading,
                        Indent,
                        IndentBlock,
                        Italic,
                        Link,
                        Paragraph,
                        Table,
                        TableCaption,
                        TableCellProperties,
                        TableColumnResize,
                        TableProperties,
                        TableToolbar,
                        Underline
                    ],
                    balloonToolbar: ['bold', 'italic', '|', 'link'],
                    heading: {
                        options: [
                            {
                                model: 'paragraph',
                                title: 'Paragraph',
                                class: 'ck-heading_paragraph'
                            },
                            {
                                model: 'heading1',
                                view: 'h1',
                                title: 'Heading 1',
                                class: 'ck-heading_heading1'
                            },
                            {
                                model: 'heading2',
                                view: 'h2',
                                title: 'Heading 2',
                                class: 'ck-heading_heading2'
                            },
                            {
                                model: 'heading3',
                                view: 'h3',
                                title: 'Heading 3',
                                class: 'ck-heading_heading3'
                            },
                            {
                                model: 'heading4',
                                view: 'h4',
                                title: 'Heading 4',
                                class: 'ck-heading_heading4'
                            },
                            {
                                model: 'heading5',
                                view: 'h5',
                                title: 'Heading 5',
                                class: 'ck-heading_heading5'
                            },
                            {
                                model: 'heading6',
                                view: 'h6',
                                title: 'Heading 6',
                                class: 'ck-heading_heading6'
                            }
                        ]
                    },
                    language: 'pt-br',
                    licenseKey: LICENSE_KEY,
                    placeholder: 'Escreva sua solicitação aqui',
                    table: {
                        contentToolbar: ['tableColumn', 'tableRow', 'mergeTableCells', 'tableProperties', 'tableCellProperties']
                    }
                };

                ClassicEditor.create(document.querySelector('#description'), editorConfig)
                    .then(editor => {
                        document.querySelector("form").addEventListener("submit", function (event) {
                            let content = editor.getData().trim(); // Remove espaços extras
                            if (content === "") {
                                Swal.fire({
                                    icon: "warning",
                                    title: "Atenção!",
                                    text: "O campo de descrição não pode estar vazio!",
                                    confirmButtonText: "OK"
                                });
                                event.preventDefault(); // Impede o envio do formulário
                            }
                        });
                    });
            }
        </script>
    </content>
</body>

</html>