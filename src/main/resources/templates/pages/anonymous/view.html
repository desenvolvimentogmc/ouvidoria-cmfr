<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <!-- Configuração do documento -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>[[${settings.title}]] - Sistema de Ouvidoria</title>

    <!-- Importação de estilos -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/assets/css/theme.bundle.css">
    <link rel="stylesheet" href="/assets/css/index.css">

    <!-- Script para controle do modo de cores -->
    <script src="/assets/js/color.mode.js"></script>
</head>

<body>
    <!-- Barra flutuante -->
    <float-bar th:replace="~{layout/landingpage/float-bar}"></float-bar>

    <div class="container">

        <div class="row align-items-center mb-7">
            <div class="col-auto">
                <!-- Avatar -->
                <div class="avatar avatar-xl rounded text-primary">
                    <i class="bi bi-upc-scan"></i>
                </div>
            </div>
            <div class="col">
                <!-- Breadcrumb -->
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-2">
                        <li class="breadcrumb-item"><a class="text-body-secondary" href="/">Página
                                Inicial</a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page"><a class="text-body-secondary"
                                href="#">Solicitações anônimas</a></li>

                    </ol>
                </nav>

                <!-- Heading -->
                <h1 class="fs-6 mb-0" aria-current="page">
                    [[${request.requestType.title}]]  | [[${request.category.description}]]
                </h1>
                <h1 class="fs-4 mb-0 mt-3">[[${request.protocol}]]</h1>
            </div>
        </div>

        <div class="row">
            <div class="col-xxl-12 col-xl-12 mb-3">
                <!-- project card -->
                <div class="card shadow d-block">
                    <div class="card-body">

                        <div class="row">
                            <div class="col-12 mb-3">
                                <div class="form-floating">
                                    <select class="form-select" id="status" th:field="*{request.status}" disabled="true">
                                        <option value="OPEN">Aberto</option>
                                        <option value="UNDER_ANALYSIS">Em análise</option>
                                        <option value="ANSWERED">Respondido</option>
                                        <option value="APPEAL">Em recurso</option>
                                        <option value="CLOSED">Finalizado</option>
                                    </select>
                                    <label for="status">Status</label>
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-6">
                                <!-- assignee -->
                                <p class="mt-2 mb-1 text-muted fw-bold font-12 text-uppercase">Departamento</p>
                                <div class="d-flex">
                                    <div>
                                        <h5 class="mt-1 font-14">
                                            [[${request.requestType.department.name}]]
                                        </h5>
                                    </div>
                                </div>
                                <!-- end assignee -->
                            </div> <!-- end col -->

                            <div class="col-sm-12 col-md-6">
                                <!-- start due date -->
                                <p class="mt-2 mb-1 text-muted fw-bold font-12 text-uppercase">Abertura</p>
                                <div class="d-flex">
                                    <i class="uil uil-schedule font-18 text-success me-1"></i>
                                    <div>
                                        <h5 class="mt-1 font-14">
                                            [[${#temporals.format(request.createdAt, 'dd/MM/yyyy HH:mm')}]]
                                        </h5>
                                    </div>
                                </div>
                                <!-- end due date -->
                            </div> <!-- end col -->
                        </div> <!-- end row -->


                        <h5 class="mt-3">Descrição:</h5>

                        <p class="text-muted mb-4" th:utext="${request.description}"></p>

                    </div> <!-- end card-body-->

                </div> <!-- end card-->

                <div class="card shadow mt-3">
                    <div class="card-header">
                        <h4 class="my-1">Respostas ([[${request.responses.size}]])</h4>
                    </div>
                    <div class="card-body">
                        <div class="timeline">
                            <div class="timeline-item border rounded p-3 mb-3"
                                th:each="response : ${request.responses}">
                                <div class="d-flex justify-content-between">
                                    <strong><i class="bi bi-person-circle me-3"></i><span
                                            class="text-primary">[[${response.user?.username}]]</span></strong>
                                    <small class="text-muted">
                                        <i class="bi bi-clock"></i>
                                        [[${#temporals.format(response.createdAt, 'dd/MM/yyyy HH:mm')}]]
                                    </small>
                                </div>
                                <p class="mt-0">
                                    <span th:utext="${response.description}"></span>
                                </p>

                                <div class="mt-2 d-flex justify-content-end border-top pt-2 align-items-center">
                                    <div class="d-flex gap-2">
                                        <a th:href="${'/api/files/' + file.path}" class="text-decoration-none"
                                            target="_blank" th:each="file : ${response.attachments}">
                                            <i class="bi bi-paperclip"></i>
                                            [[${file.originalFileName}]]
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>
        <!-- end row -->

    </div> <!-- container -->

    <!-- Rodapé do site -->
    <footer th:replace="~{layout/footer}"></footer>

    <!-- Inclua os arquivos JavaScript do Bootstrap para garantir que o Accordion funcione -->
    <script src="/assets/js/theme.bundle.js"></script>

    <script src="/assets/vendors/sweetalert2/sweetalert2.11.15.10.js"></script>
    <script>

        window.onload = () => {
            if ('[[${success}]]' !== '') {
                Swal.fire({
                    icon: 'success',
                    title: 'Manifestação registrada.',
                    html: '[[${success}]] <strong style="font-size: 20px; color: #007bff;">[[${protocol}]]</strong>. [[${message}]]',
                    confirmButtonText: 'Salvei meu n.º de protocolo',
                    allowOutsideClick: false,  // Impede o alerta de fechar ao clicar fora
                    customClass: {
                        popup: 'swal-wide', // Se quiser deixar o alerta mais largo
                    },
                });
            }
        }

        // Habilita a validação no envio do formulário
        (function () {
            'use strict'
            // Obtém todos os formulários que possuem a classe de validação
            var forms = document.querySelectorAll('.needs-validation')

            // Itera sobre os formulários e previne o envio caso não sejam válidos
            Array.prototype.slice.call(forms)
                .forEach(function (form) {
                    form.addEventListener('submit', function (event) {
                        if (!form.checkValidity()) {
                            event.preventDefault()
                            event.stopPropagation()
                        }
                        form.classList.add('was-validated')
                    }, false)
                })
        })()
    </script>
</body>

</html>