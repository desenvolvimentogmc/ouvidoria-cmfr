<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <!-- Configuração do documento -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>[[${settings.title}]] - Sistema de Informação ao Cidadão</title>

    <!-- Importação de estilos -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/assets/css/theme.bundle.css">
    <link rel="stylesheet" href="/assets/css/index.css">

    <!-- Script para controle do modo de cores -->
    <script src="/assets/js/color.mode.js"></script>
</head>

<body>
    <!-- Barra flutuante -->
    <float-bar th:replace="~{layout/landingpage/float-bar}"></float-bar>
    <!-- Cabeçalho principal com banner e descrição -->
    <header class="bg-secondary text-white py-5">
        <div class="container">
            <div class="row align-items-center">
                <!-- Imagem ilustrativa do sistema -->
                <div class="col-md-6 text-center">
                    <img src="/assets/img/backgrounds/Customer-Survey-color.svg" alt="Imagem e-SIC" class="img-fluid"
                        style="max-width: 400px;">
                </div>

                <!-- Texto introdutório sobre o e-SIC -->
                <div class="col-md-6">
                    <h4 class="text-center mb-3">O Sistema Eletrônico do Serviço de Informação ao Cidadão</h4>
                    <ul class="list-group">
                        <li class="list-group-item">Solicite informações de forma rápida.</li>
                        <li class="list-group-item">Garantia do direito ao acesso à informação.</li>
                        <li class="list-group-item">Processo transparente e eficiente.</li>
                    </ul>

                    <!-- Botão para solicitar informações -->
                    <div class="mt-3">
                        <a class="btn btn-primary w-100 rounded-4" role="button" href="/acesso">
                            <i class="bi bi-mouse3"></i> Solicitar uma informação</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Seção de estatísticas do e-SIC -->
    <section id="estatisticas" class="py-5 bg-light text-center">
        <div class="container">
            <h2>Estatísticas</h2>
            <p>Acompanhe os dados e métricas do e-SIC.</p>
            <div class="row">
                <div class="col-sm-6 col-lg-4">
                    <div class="card p-3 mb-3 shadow-sm">
                        <h3>[[${OPEN}]]</h3>
                        <p>Pedidos em aberto</p>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-4">
                    <div class="card p-3 mb-3 shadow-sm">
                        <h3>[[${APPEAL}]]</h3>
                        <p>Pedidos em recurso</p>
                    </div>
                </div>
                <div class="col-sm-12 col-lg-4">
                    <div class="card p-3 mb-3 shadow-sm">
                        <h3>[[${CLOSED}]]</h3>
                        <p>Pedidos respondidos ao cidadão</p>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12 col-lg-6 mb-3">
                    <div class="card p-3 shadow-sm" style="min-height: 400px; max-height: 400px">
                        <h4>Solicitações por tipo de pessoa</h4>
                        <div class="d-flex justify-content-center chart-container">
                            <canvas id="pieChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-sm-12 col-lg-6 mb-3">
                    <div class="card p-3 shadow-sm" style="min-height: 400px">
                        <h4>Respostas por dia</h4>
                        <div class="d-flex justify-content-center chart-container">
                            <canvas id="lineChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <p class="mt-3 mb-0">
                Fonte: desde [[${#temporals.format(releaseDate, 'dd/MM/yyyy')}]]
            </p>
        </div>
    </section>

    <!-- Seção de Perguntas Frequentes (FAQ) -->
    <section id="faq" class="py-5 text-center">
        <div class="container">
            <h2>Perguntas Frequentes</h2>
            <p>Encontre respostas para as dúvidas mais comuns sobre o e-SIC.</p>
            <div class="accordion" id="faqAccordion">
                <div class="accordion-item">
                    <h2 class="accordion-header"><button class="accordion-button" type="button"
                            data-bs-toggle="collapse" data-bs-target="#q1">O que é o e-SIC?</button></h2>
                    <div id="q1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">O e-SIC permite que qualquer pessoa solicite informações públicas de
                            órgãos do governo.</div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header"><button class="accordion-button collapsed" type="button"
                            data-bs-toggle="collapse" data-bs-target="#q2">Qual lei criou o e-SIC?</button></h2>
                    <div id="q2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">O e-SIC foi criado com base na Lei de Acesso à Informação (Lei nº
                            12.527/2011).</div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header"><button class="accordion-button collapsed" type="button"
                            data-bs-toggle="collapse" data-bs-target="#q3">Quem pode solicitar informações pelo
                            e-SIC?</button></h2>
                    <div id="q3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">Qualquer cidadão pode solicitar informações, sem necessidade de
                            justificativa.</div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header"><button class="accordion-button collapsed" type="button"
                            data-bs-toggle="collapse" data-bs-target="#q4">Como faço uma solicitação no e-SIC?</button>
                    </h2>
                    <div id="q4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">Basta acessar o sistema, preencher o formulário e enviar a
                            solicitação.</div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header"><button class="accordion-button collapsed" type="button"
                            data-bs-toggle="collapse" data-bs-target="#q5">Em quanto tempo receberei uma
                            resposta?</button></h2>
                    <div id="q5" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">O prazo é de 20 dias, podendo ser prorrogado por mais 10 dias.</div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- Rodapé do site -->
    <footer th:replace="~{layout/footer}"></footer>

    <!-- Importação de scripts -->
    <script src="/assets/js/theme.bundle.js"></script>
    <script src="/assets/vendors/chartsjs/chart.min.js"></script>
    <script>

        window.onload = async () => {
            const ctx = document.getElementById('pieChart').getContext('2d');

            const naturalPerson = '[[${naturalPersonCount}]]'
            const legalEntity = '[[${legalEntityCount}]]'

            const myChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ["Pessoa Física", "Pessoa Jurídica"],
                    datasets: [{
                        data: [naturalPerson, legalEntity], // Valores fictícios
                        backgroundColor: ["#36A2EB", "#FF6384"],
                        borderColor: ["#1E88E5", "#D32F2F"],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: "top"
                        }
                    }
                }
            });

            const { labels, values } = await getStatistics();
            // const labels = ["2024-02-14", "2024-02-15", "2024-02-16", "2024-02-17", "2024-02-18", "2024-02-19", "2024-02-20"];
            // const dataValues = [5, 12, 8, 15, 10, 18, 14];

            const ctxLine = document.getElementById('lineChart').getContext('2d');
            new Chart(ctxLine, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: "Respostas por Dia",
                        data: values,
                        borderColor: "#36A2EB",
                        backgroundColor: "rgba(54, 162, 235, 0.2)",
                        borderWidth: 2,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: "top"
                        },
                        title: {
                            display: true,
                            text: "Quantidade de Respostas por Dia"
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: "Data"
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: "Número de Respostas"
                            },
                            beginAtZero: true
                        }
                    }
                }
            });

        }

        const getStatistics = async () => {
            const response = await fetch(`/graph-responses`);

            let labels = [];
            let values = [];

            if (response.ok) {
                const data = await response.json();

                data.forEach(element => {
                    labels.push(new Date(element[0]).toLocaleDateString('pt-br'))
                    values.push(element[1])
                });

                return { values, labels }
            }

        }
    </script>
</body>

</html>